<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VerifAI | Global Fraud Defense</title>
    <style>
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 480px; text-align: center; }
        h1 { color: #1a73e8; margin: 0 0 8px 0; font-size: 2.2rem; }
        p { color: #5f6368; margin-bottom: 25px; }
        .badge { background: #e8f0fe; color: #1a73e8; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 700; display: inline-block; margin-bottom: 15px; }
        .upload-box { border: 3px dashed #1a73e8; border-radius: 12px; padding: 40px; cursor: pointer; background: #f8f9fa; transition: all 0.2s; }
        .upload-box:hover { background: #e8f0fe; transform: scale(1.02); }
        .icon { font-size: 48px; margin-bottom: 10px; }
        #preview { max-width: 100%; border-radius: 8px; margin-top: 20px; display: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button { background: #1a73e8; color: white; border: none; padding: 14px 24px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; }
        button:hover { background: #1557b0; }
        button:disabled { background: #dadce0; cursor: not-allowed; }
        #result { margin-top: 25px; padding: 20px; border-radius: 12px; display: none; text-align: left; }
        .scam { background: #fce8e6; color: #c5221f; border: 1px solid #f19e9b; }
        .safe { background: #e6f4ea; color: #137333; border: 1px solid #a8dab5; }
        .loading { display: none; margin-top: 15px; color: #1a73e8; font-weight: 500; }
        .debug { font-size: 11px; color: #aaa; margin-top:15px; display: block; font-family: monospace; }
        .settings-link { font-size: 0.8rem; color: #999; text-decoration: underline; cursor: pointer; margin-top: 10px; display: block;}
    </style>
</head>
<body>

    <div class="container">
        <h1>VerifAI üõ°Ô∏è</h1>
        <div class="badge">Powered by Gemini 3.0 & 2.0</div>
        <p>Global Fraud Defense System</p>
        
        <input type="file" id="fileInput" accept="image/*" style="display: none;">
        
        <div class="upload-box" id="uploadTrigger">
            <div class="icon">üì∑</div>
            <div style="font-weight: 500; color: #3c4043;">CLICK TO UPLOAD</div>
            <div style="font-size: 0.9rem; color: #70757a; margin-top: 5px;">Scan for Fraud / Scams</div>
        </div>
        
        <img id="preview">
        
        <button id="scanBtn" disabled>SCAN NOW</button>
        <div id="loading" class="loading">‚ö° AI is analyzing artifacts...</div>
        <div id="debug" class="debug"></div>
        
        <div id="result"></div>
        <div class="settings-link" onclick="resetKey()">‚öôÔ∏è Reset API Key</div>
    </div>

    <script>
        // ==========================================
        // üîí SECURITY: DYNAMIC KEY MANAGEMENT
        // ==========================================
        // Logic: Checks if user has a key saved. If not, asks for one.
        let API_KEY = localStorage.getItem("verifai_api_key");

        function checkApiKey() {
            if (!API_KEY) {
                const userKey = prompt("üîê SECURITY CHECK (Judge Mode):\nPlease enter your Google Gemini API Key to test VerifAI:");
                if (userKey) {
                    API_KEY = userKey;
                    localStorage.setItem("verifai_api_key", userKey);
                    return true;
                } else {
                    alert("‚ö†Ô∏è No API Key provided. The app cannot function without a key.");
                    return false;
                }
            }
            return true;
        }

        function resetKey() {
            localStorage.removeItem("verifai_api_key");
            API_KEY = null;
            alert("API Key cleared. Reloading...");
            location.reload();
        }

        // üöÄ MODEL PRIORITY LIST (Gemini 3.0 First)
        const validModels = [
            "gemini-3-pro-preview",           
            "gemini-3-flash-preview",         
            "gemini-2.0-flash-lite-preview-02-05", 
            "gemini-1.5-pro",                 
            "gemini-1.5-flash"                
        ];

        const fileInput = document.getElementById('fileInput');
        const uploadTrigger = document.getElementById('uploadTrigger');
        const scanBtn = document.getElementById('scanBtn');
        const resultDiv = document.getElementById('result');
        const loading = document.getElementById('loading');
        const debug = document.getElementById('debug');
        let fileBase64 = null;
        let fileType = null;

        uploadTrigger.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                fileType = file.type;
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('preview').src = e.target.result;
                    document.getElementById('preview').style.display = 'block';
                    fileBase64 = e.target.result.split(',')[1];
                    scanBtn.disabled = false;
                    resultDiv.style.display = 'none';
                    uploadTrigger.style.display = 'none'; 
                };
                reader.readAsDataURL(file);
            }
        });

        async function tryModel(modelName) {
            debug.innerText = "Attempting model: " + modelName + "...";
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${API_KEY}`;
            
            const payload = {
                contents: [{
                    parts: [
                        { text: "Act as a cybersecurity expert. Analyze this image. If it is a fake receipt, scam message, or phishing attempt, start with 'VERDICT: SCAM'. If it is safe/legit, start with 'VERDICT: SAFE'. Then provide 2 short bullet points explaining why." },
                        { inline_data: { mime_type: fileType, data: fileBase64 } }
                    ]
                }]
            };

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) return null; 
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                return null;
            }
        }

        scanBtn.addEventListener('click', async () => {
            // Check for key before scanning
            if (!checkApiKey()) return;

            loading.style.display = 'block';
            scanBtn.disabled = true;
            resultDiv.style.display = 'none';
            debug.style.color = "#aaa";

            let finalText = null;

            // üîÑ MODEL HUNTER LOOP
            for (const model of validModels) {
                finalText = await tryModel(model);
                if (finalText) {
                    debug.innerText += " ‚úÖ Connected!";
                    break; 
                }
            }

            loading.style.display = 'none';
            scanBtn.disabled = false;
            resultDiv.style.display = 'block';

            if (!finalText) {
                resultDiv.className = "scam"; 
                resultDiv.innerHTML = "<strong>‚ö†Ô∏è Connection Error</strong><br>Invalid API Key or Network Issue.<br><br> <span style='text-decoration:underline; cursor:pointer' onclick='resetKey()'>Click here to reset Key</span>";
                return;
            }

            if (finalText.includes("SCAM")) {
                resultDiv.className = "scam";
                resultDiv.innerHTML = `<strong>üö® FRAUD DETECTED</strong><br>${finalText.replace('VERDICT: SCAM', '')}`;
            } else {
                resultDiv.className = "safe";
                resultDiv.innerHTML = `<strong>‚úÖ VERIFIED SAFE</strong><br>${finalText.replace('VERDICT: SAFE', '')}`;
            }
        });
    </script>
</body>
</html>
